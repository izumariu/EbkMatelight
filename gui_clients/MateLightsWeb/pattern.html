<html>
  <head>
    <meta charset="UTF-8">
    <title>MateLights</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <ul class="navigation">
      <li class="inactive">
        <a href="index.html">Text</a>
      </li>
      <li class="active">
        <a href="pattern.html">Muster</a>
      </li>
    </ul>

    <div id="interface">
    </div>

    <div id="overlay" class="overlay"></div>
    <div id="modal" class="modal">
ere
<br>fejiogjiepogjpiegj
    </div>

    <button type="button" id="send" style="float: left;">Senden</button>
    <p id="errormsg"></p>
    <script>
    var lastcolors = new Array();
    lastcolors[0] = new Color();
    var ccm = new ColorChooserModal();

    var width = 5;
    var height = 8;
    var bottles = new Array();

    function initGUI() {
      var interface = document.getElementById("interface");
      interface.innerHTML = "";
      for(i = 0; i < width * height; i ++) {
        bottles[i] = new MateLightsBottle();
        bottles[i].init(interface);
      }
    }

    function ColorChooserModal() {
      var overlay = document.getElementById("overlay");
      var modal = document.getElementById("modal");
      var this_obj = this;
      overlay.addEventListener("click", function(event) {
        if (event.target == overlay) {
            this_obj.show.call(this_obj, false);
        }
      });
      /*
      this.update = function(color) {
        for(i = 0; i < 8; i ++) {
          var div = document.createElement("div");
          div.style = "border-radius: 25px; background: #73AD21; padding: 10px; width: 50px; height: 50px;";
          content.appendChild(div);
        }
      }*/

      this.show = function(show) {
        if(show == true) {
          modal.style.display = "block";
          overlay.style.display = "block";
          modal.classList.remove("slidein");
          modal.classList.add("slidein");
          overlay.classList.remove("fade");
          overlay.classList.add("fade");
        }
        else {
          modal.style.display = "none";
          overlay.style.display = "none";
        }
      }
    }

    function MateLightsBottle() {
      var color = new Color();
      var canvas = document.createElement("canvas");
      canvas.className = "bottlecanvas";
      canvas.setAttribute("style", "width: " + 100 / width + "%;");
      var context = canvas.getContext("2d");
      var this_obj = this;

      canvas.addEventListener("click", function() {
        setLastColor.call(this_obj);
      });
      canvas.addEventListener("contextmenu", function(event) {
        event.preventDefault();
        chooseColor.call(this_obj);
      });

      this.init = function(container) {
        container.appendChild(canvas);
        paintComponent();
      }

      this.setRGBColor = function(red, green, blue) {
        color.setColor(red, green, blue);
        paintComponent();
      }

      this.setColor = function(c) {
        color = c;
        paintComponent();
      }

      /*Left click or tap*/
      function setLastColor() {
        this.setColor(lastcolors[lastcolors.length - 1]);
      }

      /*Right click or long hold (like open the context menu)*/
      function chooseColor() {
        //fjiguiohruohgourdfbhfdoughfdapgvhfdgufdhgiufhgpiufdhg
        ccm.show(true);
        lastcolors[lastcolors.length] = new Color();
      }

      function paintComponent() {
        context.clearRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = color.toHexString();
        context.beginPath();
        context.arc(80, 80, 70, 0, 2 * Math.PI);
        context.fill();
      }
    }

    function Color() {
      var r = 0;
      var g = 0;
      var b = 0;

      this.setColor = function(red, green, blue) {
        r = red;
        g = green;
        b = blue;
      }

      this.toHexString = function() {
        return "#" + addZero(r.toString(16)) + addZero(g.toString(16)) + addZero(b.toString(16));
      }

      function addZero(n) {
        if(n.length == 1) {
          return "0" + n;
        }
        else {
          return n;
        }
      }
    }

    initGUI();
    </script>
    <noscript>
      Das Senden an den PHP Server funktioniert nur mit JavaScript. Generell ist alles was mit JavaScript ist cool, also mach es an! (PS: bitte sage nicht, dass
man den Inhalt eines Textfeldes auch ohne JavaScript hätte senden können, das weiß ich. Aber spätestens hier beim Muster brauche ich es eh.)
    </noscript>
  </body>
</html>
